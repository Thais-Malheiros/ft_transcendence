# Documenta√ß√£o da API - ft_transcendence

## üìö Documenta√ß√£o Interativa

A documenta√ß√£o completa e interativa da API est√° dispon√≠vel atrav√©s do **Swagger UI**.

### Acessar Documenta√ß√£o

Quando o servidor estiver rodando em modo de desenvolvimento:

```bash
npm run dev
```

Acesse: **http://localhost:3333/docs**

### Recursos do Swagger

‚úÖ **Explorar todos os endpoints** - Visualize rotas, par√¢metros e respostas
‚úÖ **Testar diretamente** - Execute requisi√ß√µes direto do navegador
‚úÖ **Exemplos reais** - Veja exemplos de requisi√ß√µes e respostas
‚úÖ **Autentica√ß√£o integrada** - Teste endpoints protegidos com seu token
‚úÖ **Valida√ß√µes documentadas** - Entenda os requisitos de cada campo

### Como Usar

1. **Endpoints P√∫blicos**: Clique em "Try it out" e execute
2. **Endpoints Protegidos**:
   - Primeiro fa√ßa login em `/auth/login` ou `/auth/anonymous`
   - Copie o token da resposta
   - Clique no bot√£o **"Authorize"** üîí no topo da p√°gina
   - Cole o token no formato: `seu_token_aqui` (sem "Bearer")
   - Clique em "Authorize"
   - Agora voc√™ pode testar endpoints protegidos

---

## Vis√£o Geral da API

### Autentica√ß√£o

A API utiliza **JWT (JSON Web Tokens)** para autentica√ß√£o. Endpoints protegidos requerem o token no header:

```
Authorization: Bearer <token>
```

### Grupos de Endpoints

#### üîê **Auth** (`/auth`)
- `POST /auth/register` - Registrar novo usu√°rio
- `POST /auth/login` - Fazer login
- `POST /auth/anonymous` - Criar sess√£o an√¥nima
- `GET /auth/me` - Obter usu√°rio atual
- `POST /auth/logout` - Encerrar sess√£o

---

## Sistema de Gangues

### Gangues Dispon√≠veis

O sistema possui duas gangues:
- **batatas** ü•î - Gangue padr√£o para usu√°rios an√¥nimos
- **ma√ßas** üçé - Dispon√≠vel apenas para usu√°rios registrados

### Regras
- Usu√°rios **registrados** escolhem sua gangue no momento do registro
- Usu√°rios **an√¥nimos** sempre pertencem √† gangue "batatas"
- A gangue n√£o pode ser alterada ap√≥s o registro
- A gangue √© inclu√≠da no token JWT

---

## Sistema de Limpeza Autom√°tica

### Usu√°rios An√¥nimos

O sistema executa limpeza autom√°tica de usu√°rios an√¥nimos inativos:

- **Tempo de inatividade:** 5 minutos
- **Intervalo de verifica√ß√£o:** 1 minuto
- **Crit√©rio:** Usu√°rios an√¥nimos que n√£o fizeram requisi√ß√µes autenticadas nos √∫ltimos 5 minutos

**Endpoints que atualizam atividade:**
- `GET /auth/me`
- Qualquer endpoint protegido

---

## C√≥digos de Status HTTP

| C√≥digo | Descri√ß√£o |
|--------|-----------|
| 200 | Sucesso |
| 400 | Requisi√ß√£o inv√°lida (valida√ß√£o falhou) |
| 401 | N√£o autorizado (token inv√°lido ou credenciais incorretas) |
| 404 | Recurso n√£o encontrado |

---

## Exemplos R√°pidos com cURL

### Registrar Usu√°rio
```bash
curl -X POST http://localhost:3333/auth/register \
  -H 'Content-Type: application/json' \
  -d '{
    "name": "Jo√£o Silva",
    "nick": "joao123",
    "email": "joao@example.com",
    "password": "Senha@123",
    "gang": "batatas"
  }'
```

### Login
```bash
curl -X POST http://localhost:3333/auth/login \
  -H 'Content-Type: application/json' \
  -d '{
    "identifier": "joao123",
    "password": "Senha@123"
  }'
```

### Sess√£o An√¥nima
```bash
curl -X POST http://localhost:3333/auth/anonymous \
  -H 'Content-Type: application/json' \
  -d '{"nick": "visitante"}'
```

### Obter Usu√°rio Atual
```bash
curl http://localhost:3333/auth/me \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"
```

### Logout
```bash
curl -X POST http://localhost:3333/auth/logout \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"
```

---

## Configura√ß√£o

### Vari√°veis de Ambiente

Crie um arquivo `.env` na raiz do projeto Back:

```env
NODE_ENV=development
JWT_SECRET=sua_chave_secreta_super_segura_aqui
```

**‚ö†Ô∏è Importante:**
- Use uma chave aleat√≥ria e segura em produ√ß√£o
- Nunca commite o arquivo `.env` no git
- Em produ√ß√£o, defina `NODE_ENV=production` para desabilitar o Swagger

### Executar o Servidor

**Desenvolvimento (com Swagger):**
```bash
cd Back
npm run dev
```

**Produ√ß√£o (sem Swagger):**
```bash
cd Back
npm run build
npm start
```

---

## Seguran√ßa

### Senhas
- ‚úÖ Armazenadas com **bcrypt** (hash + salt)
- ‚úÖ Custo de 10 rounds
- ‚úÖ Valida√ß√£o de senha forte (m√≠nimo 8 caracteres)

### JWT
- ‚úÖ Algoritmo: **HS256**
- ‚úÖ Expira√ß√£o: 2 horas (apenas an√¥nimos)
- ‚úÖ Payload: `{ id, email, nick, isAnonymous, gang }`
- ‚úÖ Secret configur√°vel via vari√°vel de ambiente

### CORS
- ‚úÖ Habilitado para desenvolvimento
- ‚ö†Ô∏è Configure origins espec√≠ficas em produ√ß√£o

---

## Desenvolvimento

### Swagger Desabilitado em Produ√ß√£o

O Swagger UI √© **automaticamente desabilitado** quando `NODE_ENV=production`. Isso:

- ‚úÖ Melhora a seguran√ßa (n√£o exp√µe estrutura da API)
- ‚úÖ Reduz o tamanho do bundle
- ‚úÖ Melhora a performance

### Linter e Formata√ß√£o

```bash
# Verificar problemas
npm run lint

# Corrigir automaticamente
npm run lint:fix
```

---

## Pr√≥ximos Passos

- [ ] Persist√™ncia em banco de dados (PostgreSQL/MongoDB)
- [ ] Testes automatizados (Jest/Vitest)
- [ ] Rate limiting
- [ ] Refresh tokens
- [ ] Endpoints de estat√≠sticas por gangue
- [ ] WebSocket para eventos em tempo real

---

## Links √öteis

- **Swagger UI (Dev)**: http://localhost:3333/docs
- **API Base URL**: http://localhost:3333
- **Reposit√≥rio**: https://github.com/seu-usuario/ft_transcendence

---

**üí° Dica:** Para detalhes completos sobre cada endpoint, valida√ß√µes, exemplos e respostas, acesse a [documenta√ß√£o Swagger](http://localhost:3333/docs) com o servidor rodando.
